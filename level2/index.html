<!DOCTYPE html>
<html>
  <head>
    <title>This is a test</title>
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@3.2.1/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
  </head>
  <body>

    <a-scene>
      <a-assets>
        <img id="groundTexture" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png">
        <img id="skyTexture" src="sky.jpg">
        <img id="nextThumbnail" src="imgLink_copy.png">
      </a-assets>
      <a-entity id='words' text="align: center; width: 5; value: Please wait until the end;" position="0 3 -3"></a-entity>
          <!--<a-entity id="minutes" text="align: center; width: 10; value: 00" position="-0.45 2 -3"></a-entity>
          <a-entity id="seconds" text="align: center; width: 10; value: 00" position="0.45 2 -3"></a-entity>
      <a-entity id="plane" geometry="primitive: plane; width: 10000; height: 10000" material="color: #fff; src: #groundTexture; repeat: 10000 10000; transparent: true; metalness: 0.6; roughness: 0.4" rotation="-90 0 0"></a-entity>-->
      <a-sky src="#skyTexture" radius="30"></a-sky>
      <a-camera>
        <a-cursor cursor="fuse: true; fuseTimeout: 1500">
          <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" fill="forwards" from="1 1 1" to="0.1 0.1 0.1"></a-animation>
          <a-animation begin="click" easing="ease-in" attribute="scale" fill="backwards" from="0.1 0.1 0.1" to="1 1 1"></a-animation>
        </a-cursor>
      </a-camera>
    </a-scene>

    <script>
    function getTimeRemaining(endtime) {
      var t = Date.parse(endtime) - Date.parse(new Date());
      var seconds = Math.floor((t / 1000) % 60);
      var minutes = Math.floor((t / 1000 / 60) % 60);
      return {
        'total': t,
        'minutes': minutes,
        'seconds': seconds
      };
    }
    function initializeClock(id, endtime) {
      var clock = document.querySelector('a-scene');
      var minutesSpanEl = document.createElement('a-entity');
      minutesSpanEl.setAttribute('text', 'align: center; width: 10;');
      minutesSpanEl.setAttribute('position', '-0.45 2 -3');
      var secondsSpanEl = document.createElement('a-entity');
      secondsSpanEl.setAttribute('text', 'align: center; width: 10;');
      secondsSpanEl.setAttribute('position', '0.45 2 -3');
      /*var firework1 = document.createElement('a-entity');
      firework1.setAttribute('position', '0 0 -5');
      firework1.setAttribute('particle-system','preset: default; color: #222; particleCount: 1000;');
      firework1.setAttribute('rotation', '0 0 45');
      var firework2 = document.createElement('a-entity');
      firework2.setAttribute('position', '0 0 -5');
      firework2.setAttribute('particle-system','preset: default; color: #222; particleCount: 1000;');
      firework2.setAttribute('rotation', '0 0 -45');
      var firework3 = document.createElement('a-entity');
      firework3.setAttribute('position', '0 0 -5');
      firework3.setAttribute('particle-system','preset: default; color: #222; particleCount: 1000;');*/
      var nextLink = document.createElement('a-entity')
      nextLink.setAttribute('link', 'on: click; href: ../level3/index.html; title: Continue; image: #nextThumbnail');
      nextLink.setAttribute('position', '0 2 -7');
      nextLink.setAttribute('id', 'next');
      function updateClock() {
        var t = getTimeRemaining(endtime);
        minutesSpanEl.setAttribute('text', 'value: '+('0' + t.minutes).slice(-2)+';');
        secondsSpanEl.setAttribute('text', 'value: '+('0' + t.seconds).slice(-2)+';');
        if (t.total <= 0) {
          clearInterval(timeinterval);
          /*clock.appendChild(firework1);
          clock.appendChild(firework2);
          clock.appendChild(firework3);*/
          clock.appendChild(nextLink);
          document.querySelector('#next').navigate('../level3/index.html');
          var end = document.querySelector('#words');
          end.setAttribute('text', 'value: Congrats! You have wasted 30 seconds');
        }
      }
      updateClock();
      var timeinterval = setInterval(updateClock, 1000);
      clock.appendChild(minutesSpanEl);
      clock.appendChild(secondsSpanEl);
    }
    var deadline = new Date(Date.parse(new Date()) + 1 * 30 * 1000);
    initializeClock('clockdiv', deadline);
    </script>

  </body>
</html>
